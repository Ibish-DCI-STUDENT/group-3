{% extends "base.html" %}
{% load static %}

{% block details %}
<link rel="stylesheet" href="{% static 'customstyle.css' %}">

<section class="details-section">
  <h1>Course Details</h1>

  {% if course.course_image %}
    <img src="{{ course.course_image }}" alt="{{ course.name }}" class="course-image" width="300" height="200">
  {% else %}
    <p>No image available</p>
  {% endif %}

  {% if course.course_video %}
    <!-- Update the link to include the course ID -->
    <div class="video-button">
      <a href="{% url 'frontend_courses:video_template' course.id %}" class="btn btn-primary">Watch Video</a>
    </div>
  {% else %}
    <p>No video available</p>
  {% endif %}

  <h2>{{ course.name }}</h2>
  <p>{{ course.description }}</p>

  {% if course.is_free %}
    <p>Is Free</p>
  {% else %}
    <p>Cost: {{ course.price }}â‚¬</p>
  {% endif %}

  <p>Instructor: {{ course.instructor }}</p>
  <p>Duration: {{ course.duration }}</p>
  <p>Published on: {{ course.published_date }}</p>

  <div class="course-details">
    <!-- Display Comments -->
    <div class="comments-section">
        <h2>Comments</h2>
        {% if course.comments %}
            <ul>
                {% for comment in course.comments %}
                    <li>
                        {{ comment.user.username }}: {{ comment.text }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No comments yet.</p>
        {% endif %}
    </div>

    <!-- Display Likes -->
    <div class="likes-section">
        <h2>Likes</h2>
        {% if course.likes %}
            <p>Total Likes: {{ course.likes.count }}</p>
        {% else %}
            <p>No likes yet.</p>
        {% endif %}
    </div>

    <!-- Display Ratings -->
    <div class="ratings-section">
        <h2>Ratings</h2>
        {% if course.ratings %}
            <ul>
                {% for rating in course.ratings %}
                    <li>
                        {{ rating.user.username }} {{ rating.value }} stars
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No ratings yet.</p>
        {% endif %}
    </div>
</div>



  {% if request.user.is_authenticated %}
  <!-- Admin actions and other content for authenticated users -->
  ...
  <!-- Add a new comment -->
  <form method="post" class="mt-4">
    {% csrf_token %}
    <div class="form-group">
      <label for="comment">Comment:</label>
      <textarea id="comment" name="comment" class="form-control"></textarea>
    </div>
    <div class="form-group">
      <label for="rating">Rating:</label>
      <input type="number" id="rating" name="rating" min="1" max="5" class="form-control">
    </div>
      <br>

    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
  {% else %}
  <!-- Content for non-authenticated users -->
  <p>Login to rate, like, and comment.</p>
  {% endif %}
  <br>
  <p></p>

{% if request.user.is_authenticated %}
    <div class="admin-actions">
    {% if not request.user.is_staff %}
      <form action="{% url 'accounts:complete_order' course.id %}" method="post">
      {% csrf_token %}
      <button type="submit" class="btn btn-primary">Buy</button>
      </form>
    {% endif %}
{% endif %}
  

{% if request.user.is_staff %}
      <a class="btn btn-primary" href="{% url 'forms:edit_course' course.id %}">Edit</a>
      <a class="btn btn-primary" href="{% url 'forms:delete_course' course.id %}">Delete</a>
{% endif %}
  

{% endblock details %}
